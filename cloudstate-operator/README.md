# Cloudstate Operator

# Prereqs

For details see https://book.kubebuilder.io/quick-start.html#prerequisites.

You need:
* golang 1.13
* kustomize v3.4.0
* kubebuilder 2.2.0
* controller-gen v0.2.4

Take a look at the [CI setup script](../ci/setup-devtools.sh) for details on installing these.

# Development

It is suggested you go through the [kubebuilder book](https://book.kubebuilder.io) to understand the
basics of kubebuilder.

The basic development approach is:

1. Update the CRD types in [api].
2. Run `make manifests generate` to update auto generated code and yaml.
3. Modify [controllers] as needed to implement the changes required.

## Make quick reference

``` sh
make test     # build controller and run tests
make run      # build and run the controller locally against the current kubectl context
make install  # install the operator CRDs into the current kubectl context
make deploy   # build the operator image, and install the operator and CRD yaml into the current kubectl context
```

## Directory structure

The directory structure of this project is:

* [api] - Contains the CustomResourceDefinition structs. Update these to modify fields.
* [controllers] - Contains the reconciliation code for updating resources based on the CRDs.
* [config] - Autogenerated by `make manifests`, contains the various yaml files necessary for running the
  operator.
* [manifests] - Self-contained yaml resources for installing the operator and its CRDs into a
  cluster. Generated by `make manifests`.
